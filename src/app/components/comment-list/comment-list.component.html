<div class="comments-section">
  <h2>Comments ({{ comments.length }})</h2>

  <div class="alert alert-error" *ngIf="error">
    {{ error }}
  </div>

  <!-- Comment form -->
  <div class="comment-form" *ngIf="currentUser">
    <textarea
      [(ngModel)]="newCommentContent"
      placeholder="Write a comment..."
      rows="3"
    ></textarea>
    <button
      class="btn btn-primary"
      (click)="onSubmitComment()"
      [disabled]="submitting || !newCommentContent.trim()"
    >
      {{ submitting ? "Posting..." : "Post Comment" }}
    </button>
  </div>

  <div class="login-prompt" *ngIf="!currentUser">
    <p>Please <a routerLink="/login">login</a> to post a comment.</p>
  </div>

  <!-- Comments list -->
  <div class="comments-list" *ngIf="!loading">
    <div class="comment-item" *ngFor="let comment of comments">
      <div class="comment-avatar">
        {{ comment.userName?.charAt(0) || "U" }}
      </div>
      <div class="comment-content">
        <div class="comment-header">
          <span class="comment-author">{{
            comment.userName || "Anonymous"
          }}</span>
          <span class="comment-date">{{
            comment.createdAt | date : "short"
          }}</span>
        </div>
        <p class="comment-text">{{ comment.content }}</p>
        <div class="comment-actions" *ngIf="canDeleteComment(comment)">
          <button
            class="btn-link text-error"
            (click)="deleteComment(comment.id)"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="loading" *ngIf="loading">
    <p>Loading comments...</p>
  </div>

  <div class="empty-state" *ngIf="!loading && comments.length === 0">
    <p>No comments yet. Be the first to comment!</p>
  </div>
</div>
